test:
  override:
    - bundle exec rake rubocop
    - bundle exec rake coffeelint
    - bundle exec brakeman -A --no-combine-locations -z -o $CIRCLE_ARTIFACTS/brakeman.html
    - bundle exec rake spec:without_features
    - bundle exec rake konacha:run
    - bundle exec rake spec:features

deployment:
  acceptance:
    branch: develop
    commands:
      - git push --force git@heroku.com:right-books-acceptance.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake db:migrate --app right-books-acceptance

  production:
    branch: master
    commands:
      - bin/build
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push mwean/right-books-app
      - docker push mwean/right-books-web
